<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>クラス連絡＋画像共有アプリ</title>
<style>
/* --- 基本スタイル --- */
body {
  box-sizing: border-box;
  font-family: system-ui, -apple-system, "メイリオ", sans-serif;
  margin: 0; padding: 20px;
  background: linear-gradient(#d6ffd6, #e0f7fa);
  color: #333;
}

.container {
  max-width: 900px; margin: 0 auto;
  background: white; border-radius: 20px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.2);
  overflow: hidden; padding: 20px;
}

.header {
  background: #a8d0ff; color: white;
  padding: 30px 20px; text-align: center;
  border-radius: 16px; margin-bottom: 10px;
}

.header h1 { margin: 0; font-size: 24px; }
.bible-text { margin-top: 8px; color: black; font-size: 16px; line-height: 1.5; }

/* --- メインコンテンツ --- */
.main-content {
  display: flex; flex-wrap: wrap;
  gap: 20px;
}

.date-buttons {
  padding: 20px; display: grid; gap: 12px; flex: 1 1 260px;
  border-right: 2px solid #e1e8ff;
  min-width: 260px;
}

.date-row { display: flex; gap: 8px; align-items: center; }
.date-row.horizontal {
  display: flex; flex-wrap: wrap; justify-content: space-between;
  margin-bottom: 8px;
}

.date-button, .omikuji-button {
  flex: 1; margin: 2px;
}
.date-button { background: #b7ffff; border: none; padding: 10px; border-radius: 8px; cursor: pointer; }
.omikuji-button {
  background: #ffc0cb; color: white;
  border: none; padding: 16px 20px;
  border-radius: 12px; font-size: 16px;
  font-weight: 500; cursor: pointer;
  text-align: center;
}
.omikuji-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(255,178,216,0.4);
}

.omikuji-result {
  margin-top: 8px; padding: 10px;
  background: #ffffbc; border-radius: 8px;
  border-left: 4px solid #fff175;
  font-size: 14px; text-align: center;
  display: none;
}

.schedule-display {
  flex: 2 1 300px; margin: 0; padding: 20px;
  background: #ddffbc; border-radius: 12px;
  border-left: 4px solid #7fffbf;
  display: none; animation: fadeIn 0.3s ease;
}
.schedule-display.show { display: block; }

@keyframes fadeIn {
  from{opacity:0; transform:translateY(10px);}
  to{opacity:1; transform:translateY(0);}
}
.schedule-date {
  font-size: 18px; font-weight: 600;
  color: #808080; margin-bottom: 15px;
  padding-bottom: 8px; border-bottom: 2px solid #e1e8ff;
}
.schedule-content {
  font-size: 15px; line-height: 1.6; color: #555;
}
.change-item {
  margin: 8px 0; padding: 8px 12px;
  background: white; border-radius: 8px;
  border-left: 5px solid #7fff7f;
}

/* --- ギャラリー --- */
#gallery {
  display: grid;
  gap: 10px;
  justify-items: center;
  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  margin-top: 20px;
}

.card {
  display: flex;
  flex-direction: column;
  width: 120px;
  border: 1px solid #ddd;
  border-radius: 8px;
  overflow: hidden;
  background: white;
  cursor: pointer;
  transition: transform 0.2s;
}
.card img {
  width: 100%;
  aspect-ratio: 1/1;
  object-fit: cover;
  border-bottom: 1px solid #eee;
}
.meta {
  font-size: 12px;
  color: #555;
  margin: 4px 6px 8px 6px;
  text-align: center;
  white-space: pre-line;
}

/* --- モーダル --- */
#modal {
  display: none; position: fixed; top: 0; left: 0;
  width: 100%; height: 100%; background: rgba(0,0,0,0.8);
  justify-content: center; align-items: center; z-index: 9999;
}
#modal img {
  max-width: 95%;
  max-height: 90%;
  border-radius: 10px;
}

/* --- iframe --- */
#drawFrame {
  width: 100%;
  height: 800px;
  border: none;
  margin-top: 20px;
  border-radius: 12px;
}

/* --- ボタン --- */
button {
  cursor: pointer; padding: 8px 12px; border-radius: 6px; border: 1px solid #bbb; background: #f7f7f7;
}

/* --- アップローダー --- */
.uploader {
  display: flex; gap: 8px; flex-wrap: wrap;
  align-items: center; margin-top: 30px;
}
#status { font-size: 13px; color: #333; margin-top: 5px; }

/* --- レスポンシブ --- */
@media(max-width:800px){
  .main-content { flex-direction: column; }
  .date-buttons { border-right: none; border-bottom: 2px solid #e1e8ff; padding-bottom: 20px; }
}
</style>
</head>
<body>
<main class="container">
  <header class="header">
    <h1 id="headerDate"></h1>
    <div class="bible-text">Peace Truth LOVE</div>
  </header>

  <div class="main-content">
    <section class="date-buttons">
      <div class="date-row">
        <button class="omikuji-button" onclick="drawOmikuji()">おみくじ　1日2回</button>
      </div>
      <div id="omikujiResult" class="omikuji-result"></div>

      <div class="date-row horizontal">
        <button class="date-button" onclick="showSchedule('today')">本日</button>
        <button class="date-button" onclick="showSchedule('tomorrow')">明日</button>
        <button class="date-button" onclick="showSchedule('following')">明後日</button>
      </div>

 
      
    </section>

    <div id="scheduleDisplay" class="schedule-display">
      <div id="scheduleDate" class="schedule-date"></div>
      <div id="scheduleContent" class="schedule-content"></div>
    </div>
  </div>

  <!-- Webページ表示エリア -->




  
 
  <section>
    <h2>１－８アルバム</h2>
    <div id="gallery"></div>
  </section>

  <section class="uploader">
    <label>投稿者名（必須）<br><input id="username" type="text" placeholder=""></label>
    <label>画像を選択<br><input id="fileInput" type="file" accept="image/*"></label>
    <button id="uploadBtn">アップロード</button>
    <div id="status"></div>
  </section>

  <div id="modal"><img id="modalImg" src=""></div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

<script>
// --- 日付自動更新 ---
const headerDate = document.getElementById("headerDate");
const today = new Date();
const options = { month: 'numeric', day: 'numeric', weekday: 'short' };
headerDate.textContent = today.toLocaleDateString('ja-JP', options);
  
// 明日・明後日の自動計算
const tomorrowDate = new Date(today);
tomorrowDate.setDate(today.getDate() + 1);

const followingDate = new Date(today);
followingDate.setDate(today.getDate() + 2);

const tomorrowStr = tomorrowDate.toLocaleDateString('ja-JP', options);
const followingStr = followingDate.toLocaleDateString('ja-JP', options);

// --- スケジュールデータ ---
const scheduleData = {
  'today': {
    date: today.toLocaleDateString('ja-JP', options),
    content: '<div class="change-item">時間割変更なし</div><div class="change-item">CM作らないと！！</div>'
  },
  'tomorrow': {
    date: tomorrowStr,
    content: '<div class="change-item">3限：聖書</div>'
  },
  'following': {
    date: followingStr,
    content: '<div class="change-item">5限：がん講話</div><div class="change-item">6限：讃美歌練習</div>'
  },


};

function showSchedule(key){
  const d = document.getElementById('scheduleDisplay');
  const dd = document.getElementById('scheduleDate');
  const c = document.getElementById('scheduleContent');
  dd.textContent = scheduleData[key].date;
  c.innerHTML = scheduleData[key].content;
  d.classList.add('show');
}

// --- おみくじ ---
const omikujiResults = [
  {name:'凶',text:'ケール 食べて！'},
  {name:'吉',text:'アサイーボウル'},
  {name:'末吉',text:'夢庵の明太かき玉うどん おいしいよ'},
  {name:'小吉',text:'牛乳寒天'},
  {name:'中吉',text:'ラーメン 食べたい'},
  {name:'大吉',text:'三角チョコパイのティラミス！'}
];

function getTodayKey(){
  return today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
}
function getDrawCount(){
  const key=getTodayKey();
  const data=JSON.parse(localStorage.getItem('omikujiCount'))||{};
  return data[key]||0;
}
function incrementDrawCount(){
  const key=getTodayKey();
  const data=JSON.parse(localStorage.getItem('omikujiCount'))||{};
  data[key]=(data[key]||0)+1;
  localStorage.setItem('omikujiCount', JSON.stringify(data));
}
function getSecondResult(){
  const key=getTodayKey()+'-secondResult';
  return JSON.parse(localStorage.getItem(key));
}
function setSecondResult(result){
  const key=getTodayKey()+'-secondResult';
  localStorage.setItem(key, JSON.stringify(result));
}

function drawOmikuji(){
  const count = getDrawCount();
  const resultBox = document.getElementById('omikujiResult');
  resultBox.style.display='block';
  if(count === 0){
    const r = Math.floor(Math.random() * omikujiResults.length);
    const result = omikujiResults[r];
    resultBox.innerHTML = `今日の運勢：<strong>${result.name}</strong><br>${result.text}`;
    incrementDrawCount();
  } else if(count === 1){
    const r = Math.floor(Math.random() * omikujiResults.length);
    const result = omikujiResults[r];
    setSecondResult(result);
    resultBox.innerHTML = `今日の運勢：<strong>${result.name}</strong><br>${result.text}`;
    incrementDrawCount();
  } else {
    const saved = getSecondResult();
    if(saved){
      resultBox.innerHTML = `今日の運勢：<strong>${saved.name}</strong><br>${saved.text}`;
    } else {
      resultBox.innerHTML = "（2回目の結果がありません）";
    }
  }
}

// --- Firebase 初期化 & 画像共有 ---
const firebaseConfig = {
  apiKey: "AIzaSyBSZkU6GaWz2stkLKjcCJEm_8uEhMEG98s",
  authDomain: "shion-b9c2a.firebaseapp.com",
  projectId: "shion-b9c2a",
  storageBucket: "shion-b9c2a.firebasestorage.app",
  messagingSenderId: "236221572207",
  appId: "1:236221572207:web:ee9e5b510fbbc3722c999a"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

const usernameInput = document.getElementById("username");
const fileInput = document.getElementById("fileInput");
const uploadBtn = document.getElementById("uploadBtn");
const status = document.getElementById("status");
const gallery = document.getElementById("gallery");
const modal = document.getElementById("modal");
const modalImg = document.getElementById("modalImg");

uploadBtn.addEventListener("click", async () => {
  const name = usernameInput.value.trim();
  const file = fileInput.files[0];
  if(!name){ status.textContent="投稿者名を入力してください。"; return; }
  if(!file){ status.textContent="画像を選択してください。"; return; }
  uploadBtn.disabled = true; status.textContent="アップロード中...";
  try{
    const ref = storage.ref("class-images/"+name+"-"+Date.now());
    await ref.put(file);
    const url = await ref.getDownloadURL();
    await db.collection("class‑images").add({ username:name, url:url, updatedAt:new Date() });
    status.textContent="アップロード完了！";
    fileInput.value="";
  }catch(e){
    console.error(e);
    status.textContent="アップロード失敗。";
  }finally{
    uploadBtn.disabled=false;
  }
});

db.collection("class‑images").orderBy("updatedAt","desc").onSnapshot(snapshot=>{
  gallery.innerHTML="";
  snapshot.forEach(doc=>{
    const data = doc.data();
    const div = document.createElement("div");
    div.className="card";
    const img = document.createElement("img");
    img.src = data.url;
    div.appendChild(img);
    const meta = document.createElement("div");
    meta.className="meta";
    meta.textContent = data.username+"\n"+new Date(data.updatedAt.seconds*1000).toLocaleString();
    div.appendChild(meta);
    img.addEventListener("click", ()=> {
      modalImg.src = data.url;
      modal.style.display = "flex";
    });
    gallery.appendChild(div);
  });
});

modal.addEventListener("click", ()=> {
  modal.style.display="none";
  modalImg.src="";
});

// --- 初期表示で今日のスケジュールを表示 ---
showSchedule('today');
</script>

</main>
</body>
</html>
