<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚¯ãƒ©ã‚¹é€£çµ¡ï¼‹ç”»åƒå…±æœ‰ã‚¢ãƒ—ãƒª</title>
<style>
body {
  boxâ€‘sizing: border-box;
  font-family: system-ui,â€‘apple-system,"ãƒ¡ã‚¤ãƒªã‚ª",sans-serif;
  margin:0; padding:20px;
  background: linear-gradient(#d6ffd6, #e0f7fa);
  color:#333;
}
.container {
  max-width:900px; margin:0 auto;
  background:white; border-radius:20px;
  box-shadow:0 10px 30px rgba(0,0,0,0.2);
  overflow:hidden; padding:20px;
}
.header {
  background:#a8d0ff; color:white;
  padding:30px 20px; text-align:center;
  border-radius:16px; margin-bottom:10px;
}
.header h1 { margin:0; font-size:24px; }
.bible-text { margin-top:8px; color:black; font-size:16px; line-height:1.5; }

.main-content {
  display:flex; flex-wrap:wrap;
}
.date-buttons {
  padding:20px; display:grid; gap:12px; flex:1;
  border-right:2px solid #e1e8ff; min-width:260px;
}
.date-row { display:flex; gap:8px; align-items:center; }
.date-row.horizontal {
  display:flex; flex-wrap:wrap; justify-content: space-between;
  margin-bottom:8px;
}
.date-button, .omikuji-button {
  flex:1; margin:2px;
}
.date-button { background:#b7ffff; border:none; }
.omikuji-button {
  background:#ffc0cb; color:white;
  border:none; padding:16px 20px;
  border-radius:12px; font-size:16px;
  font-weight:500; cursor:pointer;
  text-align:center;
}
.omikuji-button:hover {
  transform: translateY(-2px);
  box-shadow:0 6px 20px rgba(255,178,216,0.4);
}
.omikuji-result {
  margin-top:8px; padding:10px;
  background:#ffffbc; border-radius:8px;
  border-left:4px solid #fff175;
  font-size:14px; text-align:center;
  display:none;
}
.schedule-display {
  flex:1; margin:20px; padding:20px;
  background:#ddffbc; border-radius:12px;
  border-left:4px solid #7fffbf;
  display:none; animation:fadeIn 0.3s ease;
}
.schedule-display.show { display:block; }
@keyframes fadeIn {
  from{opacity:0; transform:translateY(10px);}
  to{opacity:1; transform:translateY(0);}
}
.schedule-date {
  font-size:18px; font-weight:600;
  color:#808080; margin-bottom:15px;
  padding-bottom:8px; border-bottom:2px solid #e1e8ff;
}
.schedule-content {
  font-size:15px; line-height:1.6; color:#555;
}
.change-item {
  margin:8px 0; padding:8px 12px;
  background:white; border-radius:8px;
  border-left:5px solid #7fff7f;
}
.uploader {
  display:flex; gap:8px; flex-wrap:wrap;
  align-items:center; margin-top:30px;
}
#gallery {
  display: grid;
  grid-template-columns: repeat(3, 1fr); /* iPhoneã§3åˆ—å›ºå®š */
  gap: 10px;
  justify-items: center;
  margin-top: 20px;
}

.card {
  width: 110px;       /* å›ºå®šå¹… */
  height: 150px;      /* å›ºå®šé«˜ã• */
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 6px;
  background: white;
  cursor: pointer;
  position: relative;
  transition: transform 0.2s;
}

.card img {
  width: 100px;       /* å›ºå®šã‚µã‚¤ã‚º */
  height: 100px;      /* æ­£æ–¹å½¢ã§çµ±ä¸€ */
  object-fit: cover;
  border-radius: 6px;
}

.meta {
  font-size: 11px;
  color: #555;
  margin-top: 4px;
  text-align: center;
  white-space: pre-line;
}
.card {
  border:1px solid #ddd; border-radius:8px;
  padding:8px; background:white;
  cursor:pointer; position:relative;
  transition:transform 0.2s;
}
.card:hover { transform:scale(1.05); }
.card img {
  width:100%; height:140px; object-fit:cover; border-radius:6px;
}
.meta {
  font-size:12px; color:#555; margin-top:6px; white-space:pre-line;
}
.delete-btn {
  position:absolute; top:6px; right:6px;
  background:red; color:white; border:none;
  border-radius:4px; padding:2px 6px; font-size:12px;
  cursor:pointer;
}
#modal {
  display:none; position:fixed; top:0; left:0;
  width:100%; height:100%; background:rgba(0,0,0,0.8);
  justify-content:center; align-items:center; z-index:9999;
}
#modal img { max-width:90%; max-height:90%; border-radius:10px; }
#status { font-size:13px; color:#333; margin-top:5px; }
button {
  cursor:pointer; padding:8px 12px; border-radius:6px; border:1px solid #bbb; background:#f7f7f7;
}


#memory-game {
  margin-top:40px;
  text-align:center;
}

#memory-game #game-board {
  width: min(500px, 90%);
  margin: 20px auto;
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 10px;
}

#memory-game .card {
  background: #2d89ef;
  height: 110px;
  border-radius: 8px;
  cursor: pointer;
  color: white;
  font-size: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: 0.3s;
}

#memory-game .card.flipped,
#memory-game .card.matched {
  background: #fff;
  color: #333;
  cursor: default;
}

#memory-game #restart {
  padding: 12px 24px;
  font-size: 18px;
  margin-top: 20px;
  cursor: pointer;
}

#memory-game #ranking {
  width: min(500px, 95%);
  margin: 40px auto;
  background: #fff;
  padding: 15px;
  border-radius: 10px;
  text-align: left;
}

#memory-game .rank-item {
  padding: 4px 0;
  border-bottom: 1px solid #ddd;
}



</style>
</head>
<body>
<main class="container">
  <header class="header">
    <h1>11æœˆ14æ—¥ï¼ˆé‡‘ï¼‰</h1>
    <div class="bible-text">Peace Truth LOVE</div>
  </header>

  <div class="main-content">
    <section class="date-buttons">
      <div class="date-row">
        <button class="omikuji-button" onclick="drawOmikuji()">ãŠã¿ãã˜ã€€1æ—¥2å›</button>
      </div>
      <div id="omikujiResult" class="omikuji-result"></div>

      <div class="date-row horizontal">
        <button class="date-button" onclick="showSchedule('today')">æœ¬æ—¥</button>
        <button class="date-button" onclick="showSchedule('tomorrow')">æ˜æ—¥</button>
        <button class="date-button" onclick="showSchedule('following')">æ˜å¾Œæ—¥</button>
      </div>

     <div class="date-row"><button class="date-button" onclick="showSchedule('test1')">11æœˆ18æ—¥ï¼ˆç«ï¼‰ãƒ†ã‚¹ãƒˆï¼‘æ—¥ç›®</button></div>
      <div class="date-row"><button class="date-button" onclick="showSchedule('test2')">11æœˆ19æ—¥ï¼ˆæ°´ï¼‰ãƒ†ã‚¹ãƒˆï¼’æ—¥ç›®</button></div>
      <div class="date-row"><button class="date-button" onclick="showSchedule('test3')">11æœˆ20æ—¥ï¼ˆæœ¨ï¼‰ãƒ†ã‚¹ãƒˆï¼“æ—¥ç›®</button></div>
      <div class="date-row"><button class="date-button" onclick="showSchedule('test4')">11æœˆ21æ—¥ï¼ˆé‡‘ï¼‰ãƒ†ã‚¹ãƒˆæœ€çµ‚æ—¥</button></div>
    </section>

    <div id="scheduleDisplay" class="schedule-display">
      <div id="scheduleDate" class="schedule-date"></div>
      <div id="scheduleContent" class="schedule-content"></div>
    </div>
  </div>

<section id="memory-game">
  <h1>ç¥çµŒè¡°å¼±ã‚²ãƒ¼ãƒ </h1>
  <p id="status">ã‚«ãƒ¼ãƒ‰ã‚’ã‚ãã£ã¦ãƒšã‚¢ã‚’æ¢ãã†ï¼</p>
  <div id="game-board"></div>
  <button id="restart">ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ</button>
  <div id="ranking">
    <h2>ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆä¸Šä½10åï¼‰</h2>
    <div id="ranking-list">èª­ã¿è¾¼ã¿ä¸­â€¦</div>
  </div>
</section>

  <section>
    <h2>ï¼‘ï¼ï¼˜ã‚¢ãƒ«ãƒãƒ </h2>
    <div id="gallery"></div>
  </section>

  <section class="uploader">
    <label>æŠ•ç¨¿è€…åï¼ˆå¿…é ˆï¼‰<br><input id="username" type="text" placeholder=""></label>
    <label>ç”»åƒã‚’é¸æŠ<br><input id="fileInput" type="file" accept="image/*"></label>
    <button id="uploadBtn">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</button>
    <div id="status"></div>
  </section>

<div id="modal"><img id="modalImg" src=""></div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

<script>
// --- ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ»ãŠã¿ãã˜æ©Ÿèƒ½ ---
const scheduleData = {
  'today': { date: '11/14(é‡‘)', content: '<div class="change-item">ï¼•é™ï¼šæ•°å­¦ï¼ˆã‚‚ã‚‰ãˆã¾ã—ãŸï¼ï¼‰</div>' },
  'tomorrow': { date: '11/15(åœŸ)', content: '<div class="change-item">ï¼“é™ï¼šè–æ›¸â‡’ï¼Ÿï¼Ÿ</div>' },
  'following': { date: '11/16(æ—¥)', content: '<div class="change-item">ã²ãŸã™ã‚‰ãƒ†ã‚¹ãƒˆå‹‰å¼·</div>' },
  'test1': { date: '11/18(ç«)', content:  '<div class="change-item">ï¼‘é™ï¼šè¨€èªæ–‡åŒ–</div><div class="change-item">ï¼’é™ï¼šåœ°ç†ç·åˆ</div>' },
  'test2': { date: '11/19(æ°´)', content:  '<div class="change-item">ï¼‘é™ï¼šè‹±èªCâ… </div><div class="change-item">ï¼’é™ï¼šåŒ–å­¦åŸºç¤</div>' },
  'test3': { date: '11/20(æœ¨)', content:  '<div class="change-item">ï¼‘é™ï¼šç¾ä»£ã®å›½èª</div><div class="change-item">ï¼’é™ï¼šè«–ç†è¡¨ç¾</div><div class="change-item">ï¼“é™ï¼šéŸ³æ¥½ / ç¾è¡“</div>' },
  'test4': { date: '11/21(é‡‘)', content:  '<div class="change-item">ï¼‘é™ï¼šæ­´å²ç·åˆ</div><div class="change-item">2é™ï¼šæ•°å­¦â… A</div>' }
};


const omikujiResults = [
  {name:'å‡¶',text:'ã‚±ãƒ¼ãƒ« é£Ÿã¹ã¦ï¼'},
  {name:'å‰',text:'ã‚¢ã‚µã‚¤ãƒ¼ãƒœã‚¦ãƒ«'},
  {name:'æœ«å‰',text:'å¤¢åºµã®æ˜å¤ªã‹ãç‰ã†ã©ã‚“ ãŠã„ã—ã„ã‚ˆ'},
  {name:'å°å‰',text:'ç‰›ä¹³å¯’å¤©'},
  {name:'ä¸­å‰',text:'ãƒ©ãƒ¼ãƒ¡ãƒ³ é£Ÿã¹ãŸã„'},
  {name:'å¤§å‰',text:'ä¸‰è§’ãƒãƒ§ã‚³ãƒ‘ã‚¤ã®ãƒ†ã‚£ãƒ©ãƒŸã‚¹ï¼'}
];

function getTodayKey(){
  const today=new Date();
  return today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
}
function getDrawCount(){
  const key=getTodayKey();
  const data=JSON.parse(localStorage.getItem('omikujiCount'))||{};
  return data[key]||0;
}
function incrementDrawCount(){
  const key=getTodayKey();
  const data=JSON.parse(localStorage.getItem('omikujiCount'))||{};
  data[key]=(data[key]||0)+1;
  localStorage.setItem('omikujiCount', JSON.stringify(data));
}
function getSecondResult(){
  const key=getTodayKey()+'-secondResult';
  return JSON.parse(localStorage.getItem(key));
}
function setSecondResult(result){
  const key=getTodayKey()+'-secondResult';
  localStorage.setItem(key, JSON.stringify(result));
}

function drawOmikuji(){
  const count = getDrawCount();
  const resultBox = document.getElementById('omikujiResult');
  resultBox.style.display='block';
  if(count === 0){
    const r = Math.floor(Math.random() * omikujiResults.length);
    const result = omikujiResults[r];
    resultBox.innerHTML = `ä»Šæ—¥ã®é‹å‹¢ï¼š<strong>${result.name}</strong><br>${result.text}`;
    incrementDrawCount();
  } else if(count === 1){
    const r = Math.floor(Math.random() * omikujiResults.length);
    const result = omikujiResults[r];
    setSecondResult(result);
    resultBox.innerHTML = `ä»Šæ—¥ã®é‹å‹¢ï¼š<strong>${result.name}</strong><br>${result.text}`;
    incrementDrawCount();
  } else {
    const saved = getSecondResult();
    if(saved){
      resultBox.innerHTML = `ä»Šæ—¥ã®é‹å‹¢ï¼š<strong>${saved.name}</strong><br>${saved.text}`;
    } else {
      resultBox.innerHTML = "ï¼ˆ2å›ç›®ã®çµæœãŒã‚ã‚Šã¾ã›ã‚“ï¼‰";
    }
  }
}

function showSchedule(key){
  const d = document.getElementById('scheduleDisplay');
  const dd = document.getElementById('scheduleDate');
  const c = document.getElementById('scheduleContent');
  dd.textContent = scheduleData[key].date;
  c.innerHTML = scheduleData[key].content;
  d.classList.add('show');
}



// --- Firebase åˆæœŸåŒ– & ç”»åƒå…±æœ‰æ©Ÿèƒ½ ---
const firebaseConfig = {
  apiKey: "AIzaSyBSZkU6GaWz2stkLKjcCJEm_8uEhMEG98s",
  authDomain: "shion-b9c2a.firebaseapp.com",
  projectId: "shion-b9c2a",
  storageBucket: "shion-b9c2a.firebasestorage.app",
  messagingSenderId: "236221572207",
  appId: "1:236221572207:web:ee9e5b510fbbc3722c999a"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

const usernameInput = document.getElementById("username");
const fileInput = document.getElementById("fileInput");
const uploadBtn = document.getElementById("uploadBtn");
const status = document.getElementById("status");
const gallery = document.getElementById("gallery");
const modal = document.getElementById("modal");
const modalImg = document.getElementById("modalImg");

uploadBtn.addEventListener("click", async () => {
  const name = usernameInput.value.trim();
  const file = fileInput.files[0];
  if(!name){ status.textContent="æŠ•ç¨¿è€…åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"; return; }
  if(!file){ status.textContent="ç”»åƒã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚"; return; }
  uploadBtn.disabled = true; status.textContent="ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...";
  try{
    const ref = storage.ref("class-images/"+name+"-"+Date.now());
    await ref.put(file);
    const url = await ref.getDownloadURL();
    await db.collection("classâ€‘images").add({ username:name, url:url, updatedAt:new Date() });
    status.textContent="ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Œäº†ï¼";
    fileInput.value="";
  }catch(e){
    console.error(e);
    status.textContent="ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¤±æ•—ã€‚";
  }finally{
    uploadBtn.disabled=false;
  }
});

db.collection("classâ€‘images").orderBy("updatedAt","desc").onSnapshot(snapshot=>{
  gallery.innerHTML="";
  snapshot.forEach(doc=>{
    const data = doc.data();
    const div = document.createElement("div");
    div.className="card";
    const img = document.createElement("img");
    img.src = data.url;
    div.appendChild(img);
    const meta = document.createElement("div");
    meta.className="meta";
    meta.textContent = data.username+"\n"+new Date(data.updatedAt.seconds*1000).toLocaleString();
    div.appendChild(meta);
    img.addEventListener("click", ()=> {
      modalImg.src = data.url;
      modal.style.display = "flex";
    });
    gallery.appendChild(div);
  });
});

modal.addEventListener("click", ()=> {
  modal.style.display="none";
  modalImg.src="";
});
</script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "ã‚ãªãŸã®APIã‚­ãƒ¼",
  authDomain: "ã‚ãªãŸã®ãƒ‰ãƒ¡ã‚¤ãƒ³",
  projectId: "ã‚ãªãŸã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID",
  storageBucket: "ã‚ãªãŸã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸",
  messagingSenderId: "ã‚ãªãŸã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ID",
  appId: "ã‚ãªãŸã®AppID"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ã“ã“ã‹ã‚‰ç¥çµŒè¡°å¼±ã‚²ãƒ¼ãƒ ã®JSã‚’è¨˜è¿° */
const board = document.querySelector("#memory-game #game-board");
const statusText = document.querySelector("#memory-game #status");
const restartBtn = document.querySelector("#memory-game #restart");
const rankingList = document.querySelector("#memory-game #ranking-list");

const icons = ["ğŸ","ğŸŒ","ğŸ‡","ğŸ’","ğŸ¥","ğŸ","ğŸ‰","ğŸ‘"];
let firstCard = null, secondCard = null, cards = [], lock = false, matchedCount = 0, startTime;

function initGame() {
  board.innerHTML = "";
  matchedCount = 0;
  statusText.textContent = "ã‚«ãƒ¼ãƒ‰ã‚’ã‚ãã£ã¦ãƒšã‚¢ã‚’æ¢ãã†ï¼";
  startTime = Date.now();

  cards = [...icons, ...icons]
    .sort(() => Math.random() - 0.5)
    .map((icon, i) => {
      const div = document.createElement("div");
      div.classList.add("card");
      div.dataset.icon = icon;
      div.dataset.index = i;
      div.addEventListener("click", flipCard);
      board.appendChild(div);
      return div;
    });
}

function flipCard() {
  if(lock || this.classList.contains("flipped")) return;
  this.textContent = this.dataset.icon;
  this.classList.add("flipped");
  if(!firstCard){ firstCard=this; return; }
  secondCard=this; lock=true;
  checkMatch();
}

function checkMatch() {
  if(firstCard.dataset.icon===secondCard.dataset.icon){
    firstCard.classList.add("matched");
    secondCard.classList.add("matched");
    matchedCount++;
    if(matchedCount===icons.length){
      const time = ((Date.now()-startTime)/1000).toFixed(1);
      statusText.textContent = `ã‚¯ãƒªã‚¢ï¼ãŠã‚ã§ã¨ã†ğŸ‰ï¼ˆ${time} ç§’ï¼‰`;
      saveScore(Number(time));
    }
    resetPair();
  } else {
    setTimeout(()=>{ firstCard.classList.remove("flipped"); secondCard.classList.remove("flipped"); firstCard.textContent=""; secondCard.textContent=""; resetPair(); }, 900);
  }
}

function resetPair(){ firstCard=null; secondCard=null; lock=false; }
restartBtn.addEventListener("click", initGame);
initGame();

/* Firestore ã‚¹ã‚³ã‚¢ä¿å­˜ & ãƒ©ãƒ³ã‚­ãƒ³ã‚° */
async function saveScore(time){
  const name = prompt("åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆãƒ©ãƒ³ã‚­ãƒ³ã‚°ç”¨ï¼‰", "ãªãªã—");
  if(!name) return;
  await addDoc(collection(db,"memory-ranking"),{name:name,time:time,createdAt:Date.now()});
  loadRanking();
}
async function loadRanking(){
  const q = query(collection(db,"memory-ranking"),orderBy("time","asc"),limit(10));
  const snap = await getDocs(q);
  rankingList.innerHTML="";
  snap.forEach(doc=>{
    const d = doc.data();
    const div = document.createElement("div");
    div.classList.add("rank-item");
    div.textContent = `${d.name} : ${d.time} ç§’`;
    rankingList.appendChild(div);
  });
}
loadRanking();
</script>



</main>
</body>
</html>
