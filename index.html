<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>クラス連絡＋画像共有アプリ</title>
<style>
body {
  box‑sizing: border-box;
  font-family: system-ui,‑apple-system,"メイリオ",sans-serif;
  margin:0; padding:20px;
  background: linear-gradient(#d6ffd6, #e0f7fa);
  color:#333;
}
.container {
  max-width:900px; margin:0 auto;
  background:white; border-radius:20px;
  box-shadow:0 10px 30px rgba(0,0,0,0.2);
  overflow:hidden; padding:20px;
}
.header {
  background:#a8d0ff; color:white;
  padding:30px 20px; text-align:center;
  border-radius:16px; margin-bottom:10px;
}
.header h1 { margin:0; font-size:24px; }
.bible-text { margin-top:8px; color:black; font-size:16px; line-height:1.5; }

.main-content {
  display:flex; flex-wrap:wrap;
}
.date-buttons {
  padding:20px; display:grid; gap:12px; flex:1;
  border-right:2px solid #e1e8ff; min-width:260px;
}
.date-row { display:flex; gap:8px; align-items:center; }
.date-row.horizontal {
  display:flex; flex-wrap:wrap; justify-content: space-between;
  margin-bottom:8px;
}
.date-button, .omikuji-button {
  flex:1; margin:2px;
}
.date-button { background:#b7ffff; border:none; }
.omikuji-button {
  background:#ffc0cb; color:white;
  border:none; padding:16px 20px;
  border-radius:12px; font-size:16px;
  font-weight:500; cursor:pointer;
  text-align:center;
}
.omikuji-button:hover {
  transform: translateY(-2px);
  box-shadow:0 6px 20px rgba(255,178,216,0.4);
}
.omikuji-result {
  margin-top:8px; padding:10px;
  background:#ffffbc; border-radius:8px;
  border-left:4px solid #fff175;
  font-size:14px; text-align:center;
  display:none;
}
.schedule-display {
  flex:1; margin:20px; padding:20px;
  background:#ddffbc; border-radius:12px;
  border-left:4px solid #7fffbf;
  display:none; animation:fadeIn 0.3s ease;
}
.schedule-display.show { display:block; }
@keyframes fadeIn {
  from{opacity:0; transform:translateY(10px);}
  to{opacity:1; transform:translateY(0);}
}
.schedule-date {
  font-size:18px; font-weight:600;
  color:#808080; margin-bottom:15px;
  padding-bottom:8px; border-bottom:2px solid #e1e8ff;
}
.schedule-content {
  font-size:15px; line-height:1.6; color:#555;
}
.change-item {
  margin:8px 0; padding:8px 12px;
  background:white; border-radius:8px;
  border-left:5px solid #7fff7f;
}
.uploader {
  display:flex; gap:8px; flex-wrap:wrap;
  align-items:center; margin-top:30px;
}
#gallery {
  display:grid; grid-template-columns: repeat(auto-fit, minmax(140px,1fr));
  gap:12px; margin-top:20px;
}
.card {
  border:1px solid #ddd; border-radius:8px;
  padding:8px; background:white;
  cursor:pointer; position:relative;
  transition:transform 0.2s;
}
.card:hover { transform:scale(1.05); }
.card img {
  width:100%; height:140px; object-fit:cover; border-radius:6px;
}
.meta {
  font-size:12px; color:#555; margin-top:6px; white-space:pre-line;
}
.delete-btn {
  position:absolute; top:6px; right:6px;
  background:red; color:white; border:none;
  border-radius:4px; padding:2px 6px; font-size:12px;
  cursor:pointer;
}
#modal {
  display:none; position:fixed; top:0; left:0;
  width:100%; height:100%; background:rgba(0,0,0,0.8);
  justify-content:center; align-items:center; z-index:9999;
}
#modal img { max-width:90%; max-height:90%; border-radius:10px; }
#status { font-size:13px; color:#333; margin-top:5px; }
button {
  cursor:pointer; padding:8px 12px; border-radius:6px; border:1px solid #bbb; background:#f7f7f7;
}

/* じゃんけんアニメーション */
@keyframes rpsCallAnim {
  0% { transform: scale(1); opacity:0; }
  50% { transform: scale(1.5); opacity:1; }
  100% { transform: scale(1); opacity:1; }
}
#rpsCall.animate {
  animation: rpsCallAnim 0.8s ease forwards !important;
}
/* じゃんけんボタン */
.rpsChoice {
  padding:10px 20px; margin:5px;
  font-size:16px; border-radius:8px; border:none;
  background:#ffb2d8 !important; color:white;
  cursor:pointer; transition:transform 0.2s, box-shadow 0.2s;
}
.rpsChoice:hover {
  transform: scale(1.1);
  box-shadow:0 4px 12px rgba(0,0,0,0.2);
}
/* じゃんけん中央配置 */
.rps-container {
  display:flex; flex-direction:column;
  align-items:center; justify-content:center;
  text-align:center; margin:30px 0;
}
#rpsButtons {
  display:flex; gap:10px; justify-content:center; margin-top:10px;
}
#rpsCall {
  font-size:24px; font-weight:bold; margin:10px 0;
}

.frame {
  border: 3px solid #4CAF50;      /* 緑の枠線 */
  border-radius: 12px;            /* 角丸 */
  padding: 20px;
  width: 300px;
  text-align: center;
  background-color: #f9f9f9;      /* 背景色 */
  box-shadow: 3px 3px 10px rgba(0,0,0,0.2); /* 軽い影 */
  margin: 20px auto;
}

#rpsButtons button {
  margin: 5px;
  padding: 10px 20px;
  font-size: 16px;
  cursor: pointer;
}

#rpsCall.animate {
  animation: shake 0.5s ease;
}

@keyframes shake {
  0% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  50% { transform: translateX(5px); }
  75% { transform: translateX(-5px); }
  100% { transform: translateX(0); }
}



</style>
</head>
<body>
<main class="container">
  <header class="header">
    <h1>11月14日（金）</h1>
    <div class="bible-text">Peace Truth LOVE</div>
  </header>

  <div class="main-content">
    <section class="date-buttons">
      <div class="date-row">
        <button class="omikuji-button" onclick="drawOmikuji()">おみくじ　1日2回</button>
      </div>
      <div id="omikujiResult" class="omikuji-result"></div>

      <div class="date-row horizontal">
        <button class="date-button" onclick="showSchedule('today')">本日</button>
        <button class="date-button" onclick="showSchedule('tomorrow')">明日</button>
        <button class="date-button" onclick="showSchedule('following')">明後日</button>
      </div>

     <div class="date-row"><button class="date-button" onclick="showSchedule('test1')">11月18日（火）テスト１日目</button></div>
      <div class="date-row"><button class="date-button" onclick="showSchedule('test2')">11月19日（水）テスト２日目</button></div>
      <div class="date-row"><button class="date-button" onclick="showSchedule('test3')">11月20日（木）テスト３日目</button></div>
      <div class="date-row"><button class="date-button" onclick="showSchedule('test4')">11月21日（金）テスト最終日</button></div>
    </section>

    <div id="scheduleDisplay" class="schedule-display">
      <div id="scheduleDate" class="schedule-date"></div>
      <div id="scheduleContent" class="schedule-content"></div>
    </div>
  </div>

  <!-- じゃんけんゲーム -->
 <div id="rpsFrame" class="frame">
  <h2></h2>
  <p id="rpsCall">じゃんけん</p>
  <div id="rpsButtons" style="display:none;">
    <button class="rpsChoice" data-choice="グー">グー</button>
    <button class="rpsChoice" data-choice="チョキ">チョキ</button>
    <button class="rpsChoice" data-choice="パー">パー</button>
  </div>
  <p id="rpsResult"></p>
  <p id="rpsScore">勝:0　負:0　引き分け:0</p>
  <button id="rpsStartBtn">ゲームスタート</button>
</div>


  <section>
    <h2>１－８アルバム</h2>
    <div id="gallery"></div>
  </section>

  <section class="uploader">
    <label>投稿者名（必須）<br><input id="username" type="text" placeholder=""></label>
    <label>画像を選択<br><input id="fileInput" type="file" accept="image/*"></label>
    <button id="uploadBtn">アップロード</button>
    <div id="status"></div>
  </section>

<div id="modal"><img id="modalImg" src=""></div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

<script>
// --- スケジュール・おみくじ機能 ---
const scheduleData = {
  'today': { date: '11/12(水)', content:  '<div class="change-item">３限：体育</div>' },
  'tomorrow': { date: '11/13(木)', content: '<div class="change-item">県民の日！テスト勉強！</div>' },
  'following': { date: '11/14(金)', content: '<div class="change-item">５限：数学（もらえました！）</div>' },
  'test1': { date: '11/18(火)', content:  '<div class="change-item">１限：言語文化</div><div class="change-item">２限：地理総合</div>' },
  'test2': { date: '11/19(水)', content:  '<div class="change-item">１限：英語CⅠ</div><div class="change-item">２限：化学基礎</div>' },
  'test3': { date: '11/20(木)', content:  '<div class="change-item">１限：現代の国語</div><div class="change-item">２限：論理表現</div><div class="change-item">３限：音楽 / 美術</div>' },
  'test4': { date: '11/21(金)', content:  '<div class="change-item">１限：歴史総合</div><div class="change-item">2限：数学ⅠA</div>' }
};


const omikujiResults = [
  {name:'凶',text:'ケール 食べて！'},
  {name:'吉',text:'アサイーボウル'},
  {name:'末吉',text:'夢庵の明太かき玉うどん おいしいよ'},
  {name:'小吉',text:'牛乳寒天'},
  {name:'中吉',text:'ラーメン 食べたい'},
  {name:'大吉',text:'三角チョコパイのティラミス！'}
];

function getTodayKey(){
  const today=new Date();
  return today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
}
function getDrawCount(){
  const key=getTodayKey();
  const data=JSON.parse(localStorage.getItem('omikujiCount'))||{};
  return data[key]||0;
}
function incrementDrawCount(){
  const key=getTodayKey();
  const data=JSON.parse(localStorage.getItem('omikujiCount'))||{};
  data[key]=(data[key]||0)+1;
  localStorage.setItem('omikujiCount', JSON.stringify(data));
}
function getSecondResult(){
  const key=getTodayKey()+'-secondResult';
  return JSON.parse(localStorage.getItem(key));
}
function setSecondResult(result){
  const key=getTodayKey()+'-secondResult';
  localStorage.setItem(key, JSON.stringify(result));
}

function drawOmikuji(){
  const count = getDrawCount();
  const resultBox = document.getElementById('omikujiResult');
  resultBox.style.display='block';
  if(count === 0){
    const r = Math.floor(Math.random() * omikujiResults.length);
    const result = omikujiResults[r];
    resultBox.innerHTML = `今日の運勢：<strong>${result.name}</strong><br>${result.text}`;
    incrementDrawCount();
  } else if(count === 1){
    const r = Math.floor(Math.random() * omikujiResults.length);
    const result = omikujiResults[r];
    setSecondResult(result);
    resultBox.innerHTML = `今日の運勢：<strong>${result.name}</strong><br>${result.text}`;
    incrementDrawCount();
  } else {
    const saved = getSecondResult();
    if(saved){
      resultBox.innerHTML = `今日の運勢：<strong>${saved.name}</strong><br>${saved.text}`;
    } else {
      resultBox.innerHTML = "（2回目の結果がありません）";
    }
  }
}

function showSchedule(key){
  const d = document.getElementById('scheduleDisplay');
  const dd = document.getElementById('scheduleDate');
  const c = document.getElementById('scheduleContent');
  dd.textContent = scheduleData[key].date;
  c.innerHTML = scheduleData[key].content;
  d.classList.add('show');
}

// --- じゃんけん機能 ---
const rpsCall = document.getElementById("rpsCall");
const rpsButtons = document.getElementById("rpsButtons");
const rpsResult = document.getElementById("rpsResult");
const rpsScore = document.getElementById("rpsScore");
const rpsStartBtn = document.getElementById("rpsStartBtn");

let score = { win:0, lose:0, draw:0 };
const choices = ["グー","チョキ","パー"];

// スタートボタン
rpsStartBtn.addEventListener("click", () => {
  rpsCall.textContent = "じゃーんけーん…";
  rpsButtons.style.display = "flex";
  rpsResult.textContent = "";
  rpsCall.classList.remove("animate");
  void rpsCall.offsetWidth; // 再アニメーションのためのトリガー
  rpsCall.classList.add("animate");
});

// 選択ボタンのイベント
document.querySelectorAll(".rpsChoice").forEach(btn => {
  btn.addEventListener("click", () => {
    const player = btn.getAttribute("data-choice"); // datasetより安全
    if(!player) return;
    const computer = choices[Math.floor(Math.random()*choices.length)];

    let resultText = `あなた: ${player} / 相手: ${computer} → `;
    if(player === computer){
      resultText += "引き分け";
      score.draw++;
    } else if(
      (player==="グー" && computer==="チョキ") ||
      (player==="チョキ" && computer==="パー") ||
      (player==="パー" && computer==="グー")
    ){
      resultText += "あなたの勝ち！";
      score.win++;
    } else {
      resultText += "あなたの負け…";
      score.lose++;
    }

    rpsResult.textContent = resultText;
    rpsScore.textContent = `勝:${score.win}　負:${score.lose}　引き分け:${score.draw}`;
  });
});


// --- Firebase 初期化 & 画像共有機能 ---
const firebaseConfig = {
  apiKey: "AIzaSyBSZkU6GaWz2stkLKjcCJEm_8uEhMEG98s",
  authDomain: "shion-b9c2a.firebaseapp.com",
  projectId: "shion-b9c2a",
  storageBucket: "shion-b9c2a.firebasestorage.app",
  messagingSenderId: "236221572207",
  appId: "1:236221572207:web:ee9e5b510fbbc3722c999a"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

const usernameInput = document.getElementById("username");
const fileInput = document.getElementById("fileInput");
const uploadBtn = document.getElementById("uploadBtn");
const status = document.getElementById("status");
const gallery = document.getElementById("gallery");
const modal = document.getElementById("modal");
const modalImg = document.getElementById("modalImg");

uploadBtn.addEventListener("click", async () => {
  const name = usernameInput.value.trim();
  const file = fileInput.files[0];
  if(!name){ status.textContent="投稿者名を入力してください。"; return; }
  if(!file){ status.textContent="画像を選択してください。"; return; }
  uploadBtn.disabled = true; status.textContent="アップロード中...";
  try{
    const ref = storage.ref("class-images/"+name+"-"+Date.now());
    await ref.put(file);
    const url = await ref.getDownloadURL();
    await db.collection("class‑images").add({ username:name, url:url, updatedAt:new Date() });
    status.textContent="アップロード完了！";
    fileInput.value="";
  }catch(e){
    console.error(e);
    status.textContent="アップロード失敗。";
  }finally{
    uploadBtn.disabled=false;
  }
});

db.collection("class‑images").orderBy("updatedAt","desc").onSnapshot(snapshot=>{
  gallery.innerHTML="";
  snapshot.forEach(doc=>{
    const data = doc.data();
    const div = document.createElement("div");
    div.className="card";
    const img = document.createElement("img");
    img.src = data.url;
    div.appendChild(img);
    const meta = document.createElement("div");
    meta.className="meta";
    meta.textContent = data.username+"\n"+new Date(data.updatedAt.seconds*1000).toLocaleString();
    div.appendChild(meta);
    img.addEventListener("click", ()=> {
      modalImg.src = data.url;
      modal.style.display = "flex";
    });
    gallery.appendChild(div);
  });
});

modal.addEventListener("click", ()=> {
  modal.style.display="none";
  modalImg.src="";
});
</script>

</main>
</body>
</html>

